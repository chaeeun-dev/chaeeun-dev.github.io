---
title: "[TCP/IP] #3-2. 바이트 정렬 함수"
excerpt: "바이트 정렬의 필요성과 함수"

categories:
  - Server
tags:
  - [Server]

permalink: /theory/server/3-2/

toc: true
toc_sticky: true

date: 2025-07-20
last_modified_at: 2025-07-20
---

## 바이트 정렬 함수

- 바이트 정렬(Byte Order)
    - 메모리에 데이터를 저장할 때 바이트의 배치 순서를 나타낸다.
    - 방식
        1. 빅 에디언(Big-endian): 최상위 바이트부터 차례로 저장
        2. 리틀 에디언(Little-endian): 최하위 바이트부터 차례로 저장
    - 바이트 정렬의 필요성
        - 파일에 데이터를 저장하고 읽어올 때, 네트워크를 통해 데이터를 송수신할 때 등
        - 예. 서로 다른 방식을 사용하여 파일을 전송하고 읽으면 데이터 인식 문제 오류가 발생한다.
        - 바이트 정렬을 고려해야 하는 경우를 두 가지 관점에서 살펴보자.

&nbsp;

- 바이트 정렬을 고려해야 하는 경우
    1. IP 주소, 포트 번호와 같이 프로토콜 구현을 위해 필요한 정보
        - IP 주소 바이트 정렬
            - 호스트와 라우터가 IP 주소의 바이트 정렬을 약속하지 않으면 주소 해석이 달라져 라우팅 문제가 발생할 수 있다.
        - 포트 번호 바이트 정렬
            - 두 호스트가 포트 번호 바이트 정렬을 약속하지 않으면 포트 번호 해석이 달라져 잘못된 목적지 프로세스에 데이터가 절달될 수 있다.
        - 해결
            - 위의 문제는 시스템이 사용하는 바이트정렬이 통일되어 있지 않아 발생한다.
            - IP 주소와 포트 번호의 바이트 정렬을 빅엔디언으로 통일하여 사용한다.
            - 빅엔디언은 네트워크 바이트 정렬이라고 부른다.
    2. 응용 프로그램이 주고받는 데이터
        - 호스트가 주고받는 데이터에 대해 바이트 정렬을 약속하지 않으면 데이터 해석의 문제가 발생할 수 있다.
        - 해결
            - 서버와 클라이언트 구현시 빅/리틀 에디언 중 하나로 통일해야 한다.
            - 클라이언트만 구현시 기존 서버의 바이트 정렬로 따른다.
        - 응용 프로그램 바이트 정렬 소켓 함수
            - `hton*()` 
                - 호스트 바이트 정렬 값을 네트워크 바이트 정렬로 변환한다.
                - 응용 프로그램이 소켓 함수에 데이터를 넘겨주기 전에 호출한다.
            - `ntoh*()`
                - 네트워크 바이트 정렬 값을 호스트 바이트 정렬로 변환한다.
                - 소켓 함수가 결과로 리턴한 데이터를 응용 프로그램이 출력 등의 목적으로 사용하기 전에 사용한다.
            - `*s()`는 16비트, `*l()`는 32비트를 입력으로 받는다.

![함수 호출 순서](/assets/images/post_img/server/HtonNtohFunction.png)

&nbsp;

```cpp
#include <winsock2.h>

u_short htons(u_short hostshort);   // host-to-network-short
u_long htonl(u_long hostlong);  // host-to-network-long

u_short ntohs(u_short netshort);    // network-to-host-short
u_short ntohl(u_long netlong);  // network-to-host-long
```

&nbsp;

- TCP에서 사용할 sockaddr_in/sockaddr_in6 구조체는 그림과 같은 바이트 정렬을 따른다.
    - 흰색: 호스트 바이트 정렬
    - 붉은색: 네트워크 바이트 정렬

![ByteOrder](/assets/images/post_img/server/SocketStructByteOrder.png)


--- 

*출처*
*[TCP/IP 소켓 프로그래밍](https://search.shopping.naver.com/book/catalog/33162396667?cat_id=50010766&frm=PBOKPRO&query=tcpip+%EC%86%8C%EC%BC%93+%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D&NaPm=ct%3Dmcu2vq8o%7Cci%3D46a3a47011533e76f80c1a2987e39750d2a51920%7Ctr%3Dboknx%7Csn%3D95694%7Chk%3D0ad8d61295c785b69f496e796c951cba129e06d6)*